<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring-Security-OAuth | WANGJIYAUN</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/x-icon" href="/img/logo.ico">
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
    <meta name="description" content="懒得翻身的咸鱼">
    
    <link rel="preload" href="/assets/css/0.styles.f931473a.css" as="style"><link rel="preload" href="/assets/js/app.71179a1c.js" as="script"><link rel="preload" href="/assets/js/2.b44b4809.js" as="script"><link rel="preload" href="/assets/js/25.f61ff141.js" as="script"><link rel="prefetch" href="/assets/js/10.21bb6e9c.js"><link rel="prefetch" href="/assets/js/11.a6f6c7e1.js"><link rel="prefetch" href="/assets/js/12.92e0ff90.js"><link rel="prefetch" href="/assets/js/13.6819fc77.js"><link rel="prefetch" href="/assets/js/14.a2f67803.js"><link rel="prefetch" href="/assets/js/15.77114c3a.js"><link rel="prefetch" href="/assets/js/16.e0003386.js"><link rel="prefetch" href="/assets/js/17.cdeed925.js"><link rel="prefetch" href="/assets/js/18.7579ee3c.js"><link rel="prefetch" href="/assets/js/19.9d3c72cc.js"><link rel="prefetch" href="/assets/js/20.c05479c1.js"><link rel="prefetch" href="/assets/js/21.7b69d5ed.js"><link rel="prefetch" href="/assets/js/22.cd39376a.js"><link rel="prefetch" href="/assets/js/23.6cc46bc4.js"><link rel="prefetch" href="/assets/js/24.5c8004a6.js"><link rel="prefetch" href="/assets/js/26.14c69bf4.js"><link rel="prefetch" href="/assets/js/27.784dce59.js"><link rel="prefetch" href="/assets/js/28.63053e9a.js"><link rel="prefetch" href="/assets/js/29.ff73fe88.js"><link rel="prefetch" href="/assets/js/3.5aefe87b.js"><link rel="prefetch" href="/assets/js/4.2e219475.js"><link rel="prefetch" href="/assets/js/5.934eb362.js"><link rel="prefetch" href="/assets/js/6.b994a7fc.js"><link rel="prefetch" href="/assets/js/7.95649921.js"><link rel="prefetch" href="/assets/js/8.185adbc5.js"><link rel="prefetch" href="/assets/js/9.5d6a5cd6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f931473a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout"><div class="loading"><div><div class="loader"></div> <div class="text">正在加载中~</div></div></div> <div id="landlord" data-v-1c077c9b><div class="chat-box" data-v-1c077c9b></div> <audio id="mp3" controls="controls" controlsList="nodownload" hidden="hidden" data-v-1c077c9b><source type="audio/mp3" data-v-1c077c9b></audio> <div class="robot-box robot" data-v-f412ca4a data-v-1c077c9b><input type="text" placeholder="回车或点击发送和我聊天吧~" value="" data-v-f412ca4a> <div class="btn" data-v-f412ca4a>发送</div></div> <canvas id="live2d" width="280" height="250" class="live2d" data-v-1c077c9b></canvas></div> <div class="bg"></div> <div class="index-box" data-v-82e3e2fc><div class="nav-box" data-v-0bc0d532 data-v-82e3e2fc><div class="search-nav"><div class="search-box" data-v-6597e726><input autofocus="autofocus" placeholder="搜索" value="" data-v-6597e726> <!----></div></div> <div class="nav"></div> <div class="info-box" data-v-0bc0d532><img src="https://yating.online/res/img/yating.jpg" class="my-phone" data-v-0bc0d532> <div class="info" data-v-0bc0d532><div data-v-0bc0d532><div class="my-name" data-v-0bc0d532>WANGJIYUAN</div> <div class="des" data-v-0bc0d532>懒得翻身的咸鱼</div></div></div></div></div> <div class="box" data-v-69b40e18 data-v-82e3e2fc><div class="tag-box" data-v-69b40e18><div class="tag-item" data-v-69b40e18><div class="tag-name" data-v-69b40e18>全部</div> <div class="tag-num" data-v-69b40e18>0</div></div> </div></div> <div class="content-box" data-v-82e3e2fc><div class="content"><div class="catalog-item-big"><div class="title">
                    
                </div> <div class="article-time">
                    5/16/2021, 9:43:11 PM
                </div></div> <div class="content__default"><h1 id="spring-security-oauth"><a href="#spring-security-oauth" class="header-anchor">#</a> Spring Security OAuth</h1> <h2 id="spring-security-oauth-2-0-认证授权"><a href="#spring-security-oauth-2-0-认证授权" class="header-anchor">#</a> <strong>Spring Security OAuth 2.0 认证授权</strong></h2> <h2 id="_1-基于session的认证流程"><a href="#_1-基于session的认证流程" class="header-anchor">#</a> 1.基于Session的认证流程</h2> <p>依赖包</p> <div class="language-xml extra-class"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>Spring Security 本质是一个过滤链</strong></p> <h2 id="重要的接口"><a href="#重要的接口" class="header-anchor">#</a> 重要的接口</h2> <h3 id="_1-userdetailsservice"><a href="#_1-userdetailsservice" class="header-anchor">#</a> 1.UserDetailsService</h3> <p>查询数据库中的账户名和密码</p> <h3 id="_2-passwordencoder"><a href="#_2-passwordencoder" class="header-anchor">#</a> 2.PasswordEncoder</h3> <p>加密接口</p> <p>Web权限方案：认证和授权</p> <p>设置登录名和密码的方案</p> <p>1.通过配置文件</p> <div class="language-java extra-class"><pre class="language-java"><code>spring<span class="token punctuation">.</span>security<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token operator">=</span>atguigu
spring<span class="token punctuation">.</span>security<span class="token punctuation">.</span>user<span class="token punctuation">.</span>password<span class="token operator">=</span>atguigu
</code></pre></div><p>2.编写</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebSecurityConfigurerAdapter</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationManagerBuilder</span> auth<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">BCryptPasswordEncoder</span> passwordEncoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> password <span class="token operator">=</span> passwordEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        auth<span class="token punctuation">.</span><span class="token function">inMemoryAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withUser</span><span class="token punctuation">(</span><span class="token string">&quot;lucy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">roles</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">PasswordEncoder</span> <span class="token function">password</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-自定义编写实现类"><a href="#_3-自定义编写实现类" class="header-anchor">#</a> 3.自定义编写实现类</h3> <div class="language- extra-class"><pre class="language-text"><code>1.创建配置类，设置使用userDetailsServices实现类
2.编写实现类，返回User对象，User对象有用户名密码和操作
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyUserDetailService</span> <span class="token keyword">implements</span> <span class="token class-name">UserDetailsService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserDetails</span> <span class="token function">loadUserByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UsernameNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> auths <span class="token operator">=</span> <span class="token class-name">AuthorityUtils</span><span class="token punctuation">.</span><span class="token function">commaSeparatedStringToAuthorityList</span><span class="token punctuation">(</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;marry&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> auths<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="查询数据库完成用户认证"><a href="#查询数据库完成用户认证" class="header-anchor">#</a> 查询数据库完成用户认证</h2> <p>1.引入相关依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>2.创建数据库和用户表</p> <p>3.创建User表对应实体类</p> <p>4.整合Mapper</p> <p>5.在MyUserDetailsService 调用mapper里面方法查询数据库进行用户认证</p> <p>6.添加mapperScan</p> <p>7.配置数据库</p> <h2 id="自定义配置页面"><a href="#自定义配置页面" class="header-anchor">#</a> 自定义配置页面</h2> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        http<span class="token punctuation">.</span><span class="token function">formLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 登陆页面</span>
                <span class="token punctuation">.</span><span class="token function">loginPage</span><span class="token punctuation">(</span><span class="token string">&quot;/login.html&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//登录访问路径</span>
                <span class="token punctuation">.</span><span class="token function">loginProcessingUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">//登录之后跳转路径</span>
                <span class="token punctuation">.</span><span class="token function">defaultSuccessUrl</span><span class="token punctuation">(</span><span class="token string">&quot;/test/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authorizeRequests</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// 设置那些路径可以直接访问，不需要认证</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/test/hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/user/login&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">authenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//关闭csrf防护</span>
                <span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">csrf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h1 id="基于角色或权限控制访问与授权"><a href="#基于角色或权限控制访问与授权" class="header-anchor">#</a> 基于角色或权限控制访问与授权</h1> <h2 id="_1-hasauthority方法"><a href="#_1-hasauthority方法" class="header-anchor">#</a> 1.HasAuthority方法</h2> <p>1.在配置类设置当前访问地址有哪些权限</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token comment">//当前用户只有具有admin权限才可以访问这个路径</span>
                <span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/test/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAnyAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;admins&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>2.在UserDetailsServices里做设置</p> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> auths <span class="token operator">=</span> <span class="token class-name">AuthorityUtils</span><span class="token punctuation">.</span><span class="token function">commaSeparatedStringToAuthorityList</span><span class="token punctuation">(</span><span class="token string">&quot;admins&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_2-hasanyauthority方法"><a href="#_2-hasanyauthority方法" class="header-anchor">#</a> 2.hasAnyAuthority方法</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token punctuation">.</span><span class="token function">antMatchers</span><span class="token punctuation">(</span><span class="token string">&quot;/text/index&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasAnyAuthority</span><span class="token punctuation">(</span><span class="token string">&quot;admins,manager&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_3-hasrole方法"><a href="#_3-hasrole方法" class="header-anchor">#</a> 3.hasRole方法</h2> <p>源码中返回的结果为</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">return</span> <span class="token string">&quot;hasRole('ROLE_&quot;</span> <span class="token operator">+</span> role <span class="token operator">+</span> <span class="token string">&quot;')&quot;</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">//拥有此权限才允许访问</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GrantedAuthority</span><span class="token punctuation">&gt;</span></span> auths <span class="token operator">=</span> <span class="token class-name">AuthorityUtils</span><span class="token punctuation">.</span><span class="token function">commaSeparatedStringToAuthorityList</span><span class="token punctuation">(</span><span class="token string">&quot;admins,ROLE_sale&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_4-hasanyrole方法"><a href="#_4-hasanyrole方法" class="header-anchor">#</a> 4.hasAnyRole方法</h2> <p>与HasAnyAuthority相似</p> <h1 id="自定义403无权限访问页面"><a href="#自定义403无权限访问页面" class="header-anchor">#</a> 自定义403无权限访问页面</h1> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210110162525807.png" alt="image-20210110162525807"></p> <p>直接在配置类中进行设置</p> <h1 id="注解的使用"><a href="#注解的使用" class="header-anchor">#</a> 注解的使用</h1> <h2 id="secured"><a href="#secured" class="header-anchor">#</a> @Secured</h2> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210111000351243.png" alt="image-20210111000351243"></p> <h2 id="preauthorize"><a href="#preauthorize" class="header-anchor">#</a> @PreAuthorize</h2> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210111000446832.png" alt="image-20210111000446832"></p> <h2 id="postauthorize"><a href="#postauthorize" class="header-anchor">#</a> @PostAuthorize</h2> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210111000532067.png" alt="image-20210111000532067"></p> <h1 id="解决跨域请求的问题"><a href="#解决跨域请求的问题" class="header-anchor">#</a> 解决跨域请求的问题</h1> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210111003010203.png" alt="image-20210111003010203"></p> <h2 id="用户注销的实现"><a href="#用户注销的实现" class="header-anchor">#</a> 用户注销的实现</h2> <p>1.在配置类中添加退出配置</p> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210120223104916.png" alt="image-20210120223104916"></p> <h2 id="自动登录"><a href="#自动登录" class="header-anchor">#</a> 自动登录</h2> <p>1.cookies技术</p> <p>2.安全框架机制实现自动登录</p> <p><strong>实现原理</strong></p> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210120231543690.png" alt="image-20210120231543690"></p> <p><strong>具体实现</strong></p> <p>1.创建数据库表</p> <p>2.注入数据源</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PersistentTokenRepository</span> <span class="token function">persistentTokenRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JdbcTokenRepositoryImpl</span> jdbcTokenRepository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTokenRepositoryImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jdbcTokenRepository<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// jdbcTokenRepository.setCreateTableOnStartup(true);</span>
        <span class="token keyword">return</span> jdbcTokenRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>3.配置类中配置自动登录</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * //操作数据库对象
 */</span>
<span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rememberMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tokenRepository</span><span class="token punctuation">(</span><span class="token function">persistentTokenRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">/**
 * 设置有效时常，单位秒
 */</span>
<span class="token punctuation">.</span><span class="token function">tokenValiditySeconds</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span>
<span class="token comment">/**
 * 操作数据库
 */</span>
<span class="token punctuation">.</span><span class="token function">userDetailsService</span><span class="token punctuation">(</span>userDetailsService<span class="token punctuation">)</span>
</code></pre></div><p>5.测试页面</p> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210120230735554.png" alt="image-20210120230735554"></p> <p><strong>name名称remember-me不可以为其他的</strong></p> <h2 id="csrf理解"><a href="#csrf理解" class="header-anchor">#</a> CSRF理解</h2> <p>会针对PATCH、Post、Put、Delete方法进行保护</p> <h1 id="springsecurity微服务权限方案"><a href="#springsecurity微服务权限方案" class="header-anchor">#</a> SpringSecurity微服务权限方案</h1> <h3 id="_1-权限管理数据模型"><a href="#_1-权限管理数据模型" class="header-anchor">#</a> 1.权限管理数据模型</h3> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210121000041018.png" alt="image-20210121000041018"></p> <p>需求：</p> <p>1.添加用户</p> <p>2.为角色分配菜单</p> <p>3.添加用户</p> <p>4.为用户分配角色</p> <h3 id="_2-案例设计技术说明"><a href="#_2-案例设计技术说明" class="header-anchor">#</a> 2.案例设计技术说明</h3> <p>1.Maven</p> <p>2.Spring Boot</p> <p>3.MyBatisPlus 操作数据库框架</p> <p>4.Spring Cloud</p> <p>(1)GateWay网关</p> <p>（2）注册中心 NacOS</p> <p>5.Redis</p> <p>JWT</p> <p>Swagger</p> <h3 id="_3-搭建项目和服务"><a href="#_3-搭建项目和服务" class="header-anchor">#</a> 3.搭建项目和服务</h3> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210121004721230.png" alt="image-20210121004721230"></p> <p>2.引入依赖</p> <p>3.启动Redis Nacos</p> <p>（1）、启动Redis</p> <p>（2）、启动Nacos</p> <p>http://192.168.187.128:8848/nacos/index.html</p> <h3 id="_4-编写代码"><a href="#_4-编写代码" class="header-anchor">#</a> 4.编写代码</h3> <p><img src="C:%5CUsers%5C79443%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210123231338039.png" alt="image-20210123231338039"></p> <p>跨域问题的产生：</p> <p>ip地址 端口号 协议的不同就产生了跨域的问题</p></div> <!----> <!----> <div class="over">
            完
            <div class="block"></div></div> <div id="gitalk-container"></div></div> <div class="catalog "><!----> <div class="level1"></div> <a href="#spring-security-oauth-2-0-认证授权" nofollow class="level2">Spring Security OAuth 2.0 认证授权</a><a href="#_1-基于session的认证流程" nofollow class="level2">1.基于Session的认证流程</a><a href="#重要的接口" nofollow class="level2">重要的接口</a><a href="#_1-userdetailsservice" nofollow class="level3">1.UserDetailsService</a><a href="#_2-passwordencoder" nofollow class="level3">2.PasswordEncoder</a><a href="#_3-自定义编写实现类" nofollow class="level3">3.自定义编写实现类</a><a href="#查询数据库完成用户认证" nofollow class="level2">查询数据库完成用户认证</a><a href="#自定义配置页面" nofollow class="level2">自定义配置页面</a><a href="#_1-hasauthority方法" nofollow class="level2">1.HasAuthority方法</a><a href="#_2-hasanyauthority方法" nofollow class="level2">2.hasAnyAuthority方法</a><a href="#_3-hasrole方法" nofollow class="level2">3.hasRole方法</a><a href="#_4-hasanyrole方法" nofollow class="level2">4.hasAnyRole方法</a><a href="#secured" nofollow class="level2">@Secured</a><a href="#preauthorize" nofollow class="level2">@PreAuthorize</a><a href="#postauthorize" nofollow class="level2">@PostAuthorize</a><a href="#用户注销的实现" nofollow class="level2">用户注销的实现</a><a href="#自动登录" nofollow class="level2">自动登录</a><a href="#csrf理解" nofollow class="level2">CSRF理解</a><a href="#_1-权限管理数据模型" nofollow class="level3">1.权限管理数据模型</a><a href="#_2-案例设计技术说明" nofollow class="level3">2.案例设计技术说明</a><a href="#_3-搭建项目和服务" nofollow class="level3">3.搭建项目和服务</a><a href="#_4-编写代码" nofollow class="level3">4.编写代码</a> <!----></div> <!----></div></div> <div class="foot"> WANG JIYUAN BLOG</div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.71179a1c.js" defer></script><script src="/assets/js/2.b44b4809.js" defer></script><script src="/assets/js/25.f61ff141.js" defer></script>
  </body>
</html>
